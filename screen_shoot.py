from unittest.mock import patch
import numpy as np
import cv2
import pyautogui
import os
import requests
import time
import os

getCwd = os.getcwd()
getCwd = '\\'.join(getCwd.split('\\')[:len(getCwd.split('\\'))])

openFile = "{0}\\image{1}.png"
baseName = "{0}\\image{1}.png"


num = str(1)

path = ""
def screenShoot():
	global path
	save_filename = "image*.png"
	save_dirname = getCwd
	path = str(os.path.join(save_dirname, save_filename))

	while True:
		if(os.path.isdir(getCwd)):
			pass
		else:
			os.mkdir(getCwd)

		image = pyautogui.screenshot()
		image = cv2.cvtColor(np.array(image),cv2.COLOR_RGB2BGR)
		cv2.imwrite(path.replace("*",num), image)

		time.sleep(3)
		url = 'http://localhost:8080/uploadphoto'
		with open(openFile.format(getCwd, num), 'rb') as img:
			name_img= os.path.basename(baseName.format(getCwd, num))
			files= {'image': (name_img,img,'multipart/form-data',{'Expires': '0'}) }
			with requests.Session() as s:
				time.sleep(3)
				try:
					r = s.post(url,files=files)
				except Exception:
					os.remove(os.getcwd() + "\\image1.png")
					exit()
				break

screenShoot()


try:
	while True:
		if os.path.isfile(os.getcwd() + "\\image1.png"):
			os.remove(os.getcwd() + "\\image1.png")
		else:
			pass
		screenShoot()

except Exception:
	if os.path.isfile(os.getcwd() + "\\image1.png"):
		os.remove(os.getcwd() + "\\image1.png")
	else:
		pass
	
		